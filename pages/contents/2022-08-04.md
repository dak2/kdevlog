---
title: '<æ›¸è©•> type-challengesã§easyã‹ã‚‰mediumã¾ã§81å•è§£ã„ã¦å­¦ã‚“ã TSã®å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°'
published_at: '2022-08-04'
updated_at: '2023-07-29'
categories: 'TypeScript,Book'
---

## æ¦‚è¦

[type-challenges](https://github.com/type-challenges/type-challenges) ã¨ã„ã†TSæ–‡æ³•ã®ç·´ç¿’å•é¡Œãƒªãƒã‚¸ãƒˆãƒªãŒã‚ã‚‹ã€‚

èˆˆå‘³æœ¬ä½ã§è§£ã„ã¦ã¿ãŸã‚‰æ¥½ã—ããªã£ã¦ãã¦easyãƒ¬ãƒ™ãƒ«ã‹ã‚‰mediumãƒ¬ãƒ™ãƒ«ã¾ã§81å•è§£ã„ã¦ã—ã¾ã£ãŸã€‚

ãã®éš›ã«TSã«ã¤ã„ã¦ã®å­¦ã³ãŒè‰²ã€…ã‚ã£ãŸã®ã§å…±æœ‰ã™ã‚‹ã€‚

## å­¦ã³ä¸€è¦§

- mapped types
- conditional types
- infer
- minus operator
- union distribution
- never
- template literal types
- length property
- index(numeric) signature
- bottom type

### mapped types

å…¬å¼doc: [https://www.typescriptlang.org/docs/handbook/2/mapped-types.html](https://www.typescriptlang.org/docs/handbook/2/mapped-types.html)
å‹å¼•æ•°ãŒä¸»ã«ãƒ¦ãƒ‹ã‚ªãƒ³å‹orã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã«åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚å‹å¼•æ•°ã‚’ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦çµæœå‡ºåŠ›ã™ã‚‹ã€‚

```typescript
type MappedTypes<T extends object> = { [P in keyof T]: T[P] };
type s = MappedTypes<{ key: 'test'; value: 'test' }>;
// type s = {
//   key: 'test';
//   value: 'test';
// }

type MappedTypes2<T extends string> = { [P in T]: string };
type t = MappedTypes2<'test' | 'tt'>;
// type t = {
//   test: string;
//   tt: string;
// }
```

### conditional types

å…¬å¼doc: [https://www.typescriptlang.org/docs/handbook/2/conditional-types.html](https://www.typescriptlang.org/docs/handbook/2/conditional-types.html)
å‹ã®æ¡ä»¶åˆ†å²ã‚’å®Ÿç¾ã™ã‚‹ã€‚

```typescript
TypeA extends TypeB ? true : false
```

å…¬å¼docã«ã‚ˆã‚‹ã¨ã“ã®æ¡ä»¶ã¯extendsã®å·¦ã®å‹ãŒå³ã®å‹ã«ä»£å…¥å¯èƒ½ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¦ã„ã‚‹ã€‚

> When the type on the left of the extends is assignable to the one on the right, then youâ€™ll get the type in the first branch (the â€œtrueâ€ branch); otherwise youâ€™ll get the type in the latter branch (the â€œfalseâ€ branch).

ãã®ãŸã‚ã“ã‚Œã¯ã‚‚ã¡ã‚ã‚“false

```typescript
type test = string extends number ? true : false;
// => false
```

ã“ã¡ã‚‰ã¯åŸå‰‡ã‹ã‚‰è€ƒãˆã¦trueã«ãªã‚‹ã€‚

```typescript
type test = 't' extends string ? true : false;
// => true
```

bottom typeã®ç¯€ã§neverã‚„undefinedã‚’conditional typesã§æ¯”è¼ƒæ¤œè¨¼ã™ã‚‹ã€‚

### infer

[å…¬å¼doc](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html#type-inference-in-conditional-types)
å‹ã‚’å‰²ã‚Šå‡ºã—ã¦ãã®å¾Œåˆ©ç”¨ã§ãã‚‹ã€‚

conditional typesã¨ã‚»ãƒƒãƒˆã§åˆ©ç”¨ã™ã‚‹ã€‚

ä¾‹ãˆã°ã€type-challengesã®[Last of Array](https://github.com/type-challenges/type-challenges/blob/main/questions/00015-medium-last/README.md) ã®å•é¡Œã§ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«è§£ã‘ã‚‹ã€‚

å‹å¼•æ•°Tã‚’conditional typesã§åˆ†å²ã•ã›ã€ãã®ä¸­ã§inferã‚’åˆ©ç”¨ã—ã¦æ¨è«–ã—ãŸå¤‰æ•°Lï¼ˆé…åˆ—ã®æœ€å¾Œã®è¦ç´ ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

```typescript
type Last<T extends any[]> = T extends [...infer _, infer L] ? L : never;
type s = Last<[]>;
// => never

type t = Last<[1, 2, 3]>;
// => 3
```

### minus operator

[å…¬å¼doc](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html#improved-control-over-mapped-type-modifiers)
mapped typeså†…ã®readonlyã‚„?ã‚’å‰Šé™¤ã™ã‚‹ãŸã‚ã®ä¿®é£¾å­ä¾‹ãˆã°ã€type-challengesã®[Mutable](https://github.com/type-challenges/type-challenges/blob/main/questions/02793-medium-mutable/README.md) ã®å•é¡Œã§ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«è§£ã‘ã‚‹ã€‚

```typescript
type Mutable<T> = {
  -readonly [K in keyof T]: T[K];
};

type s = Mutable<{ readonly test: 1 }>;
// type s = {
//   test: 1;
// }
```

### union distribution

**conditional types**ã‚„**mapped types**ã«unionå‹ã‚’æ¸¡ã™ã¨1ã¤ãšã¤å‡¦ç†ã•ã‚Œã‚‹ã€‚

conditional typesã§ã¯æ¡ä»¶ã®å·¦éƒ¨åˆ†ãŒå‹å¤‰æ•°ã§ã‚ã‚‹å ´åˆã«unionå‹ãŒåˆ†é…ã•ã‚Œã‚‹ã€‚

```typescript
type Equal<U> = U extends 1 ? U : never;
type s = Equal<1 | 2>;
// type s = 1
```

ä¾‹ã®ã‚³ãƒ¼ãƒ‰ã§ã¯å‹å¤‰æ•°Uã«unionå‹ãŒæ¸¡ã£ã¦ãŠã‚Š1ã ã‘ã‚’è¿”ã™ã€‚ã¤ã¾ã‚Šä¸‹è¨˜ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã€‚

```typescript
type TypeA = (1 extends 1) ? U : never
type TypeB = (2 extends 1) ? U : never
```

mapped typesã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã®å ´åˆã«union distributionãŒç™ºç”Ÿã™ã‚‹ã€‚

```typescript
{ [P in keyof T]: X}
```

```typescript
type Distribution<T> = { [P in keyof T]: T[P] };
type val = Distribution<{ foo: string } | { bar: number }>;
// type val = Distribution<{
//    foo: string;
// }> | Distribution<{
//    bar: number;
// }>
```

### never

[ã‚µãƒã‚¤ãƒãƒ«TypeScript](https://typescriptbook.jp/reference/statements/never)ã‚ˆã‚Š

> TypeScriptã®neverã¯ã€Œå€¤ã‚’æŒãŸãªã„ã€å‹ã€‚
> 1ï¸âƒ£ç‰¹æ€§1: neverã¸ã¯ä½•ã‚‚ä»£å…¥ã§ããªã„
> 2ï¸âƒ£ç‰¹æ€§2: neverã¯ä½•ã«ã§ã‚‚ä»£å…¥ã§ãã‚‹
> ğŸ’¥å¸¸ã«ä¾‹å¤–ã‚’èµ·ã“ã™é–¢æ•°ã®æˆ»ã‚Šå€¤ã«ä½¿ãˆã‚‹

[TypeScript Deep Dive](https://typescript-jp.gitbook.io/deep-dive/type-system/never)ã‚ˆã‚Š

> ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®è¨­è¨ˆã«ã¯ã€bottomå‹ã®æ¦‚å¿µãŒã‚ã‚Šã¾ã™ã€‚
> ãã‚Œã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è§£æã‚’è¡Œã†ã¨ç¾ã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚
> TypeScriptã¯ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è§£æ(ğŸ˜)ã‚’å®Ÿè¡Œã™ã‚‹ã®ã§ã€æ±ºã—ã¦èµ·ã“ã‚Šãˆãªã„ã‚ˆã†ãªã‚‚ã®ã‚’ç¢ºå®Ÿã«è¡¨ç¾ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
> neverå‹ã¯ã€ã“ã®bottomå‹ã‚’è¡¨ã™ãŸã‚ã«TypeScriptã§ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

[Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AD%E3%83%BC%E8%A7%A3%E6%9E%90) ã‚ˆã‚Š

> ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è§£æï¼ˆè‹±: Data-flow analysisï¼‰ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã®æ§˜ã€…ãªä½ç½®ã§ã€å–ã‚Šã†ã‚‹å€¤ã®é›†åˆã«é–¢ã™ã‚‹æƒ…å ±ã‚’åé›†ã™ã‚‹æŠ€æ³•ã§ã‚ã‚‹ã€‚

åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã‚°ãƒ©ãƒ• (CFG)ã‚’ä½¿ã£ã¦å¤‰æ•°ã®å€¤ãŒä¼æ’­ã™ã‚‹ã‹ã©ã†ã‹ãªã©ã®æƒ…å ±ã‚’é›†ã‚ã€åˆ©ç”¨ã™ã‚‹ã€‚

ã“ã®ã‚ˆã†ã«ã—ã¦é›†ã‚ã‚‰ã‚ŒãŸæƒ…å ±ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæœ€é©åŒ–ã«åˆ©ç”¨ã™ã‚‹ã€‚

ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è§£æã®åŸºæœ¬ã¯åˆ°é”å®šç¾© (reaching definition) ã§ã‚ã‚‹ã€‚

### template literal types

JSã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ã‚’ä½¿ã£ã¦å±•é–‹ã—ãŸå€¤ã‚’ãã®ã¾ã¾å‹ã¨ã—ã¦å®šç¾©ã§ãã‚‹ã€‚

```typescript
type Join<T extends string, U extends string> = `${T}-${U}`;
type joinedStr = Join<'foo', 'bar'>;
// type joinedStr = "foo-bar"
```

conditional types + inferã‚’åˆ©ç”¨ã—ã¦ã„ã“ã‚“ãªé¢¨ã«ã‚‚æ›¸ã‘ã‚‹ã€‚

```typescript
type TemplateLiteral<T extends string> = T extends `${infer F}${infer _L}`
  ? F
  : never;
type str = TemplateLiteral<'foo'>;
// type str = "f"
```

type-challengesã§æ–‡å­—åˆ—æ“ä½œã™ã‚‹ã¨ãã«åˆã‚ã¦çŸ¥ã£ã¦è¡¨ç¾åŠ›ã«é©šã„ãŸãªã€‚

### length property

é…åˆ—ã‚„ã‚¿ãƒ—ãƒ«ã®è¦ç´ æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦è¿”ã™

```typescript
type val = [1, 3]['length'];
// type val = 2
```

Arrayã®interfaceã«lengthãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã€‚

```typescript
interface Array<T> {
  /**
   * Gets or sets the length of the array. This is a number one higher than the highest index in the array.
   */
  length: number;
}
```

[https://github.com/microsoft/TypeScript/blob/main/lib/lib.es5.d.ts#L1220-L1402](https://github.com/microsoft/TypeScript/blob/main/lib/lib.es5.d.ts#L1220-L1402)

### index (numeric) signature

é…åˆ—(orã‚¿ãƒ—ãƒ«)Tã«ãŠã„ã¦T[number]ãŒunionå‹ã§è¿”ã‚‹ã“ã¨ã‹ã‚‰çŸ¥ã£ãŸ
[å…¬å¼doc](https://www.typescriptlang.org/docs/handbook/2/conditional-types.html) ã«ã‚‚è¨˜è¼‰ã‚ã‚‹ã€‚

[stackoverflow](https://stackoverflow.com/a/59188070) ã®è¨˜äº‹ã§ã¯ã€Arrayã¯ä¸‹è¨˜ã®ã‚ˆã†ãªinterfaceã«ãªã£ã¦ã„ã¦ numberã‚’ä½¿ã£ã¦indexã‚’ã¾ã¨ã‚ã¦å–å¾—ã§ãã‚‹ã‚ˆã†ã€‚

[https://github.com/microsoft/TypeScript/blob/main/lib/lib.es5.d.ts#L388-L392](https://github.com/microsoft/TypeScript/blob/main/lib/lib.es5.d.ts#L388-L392)
ã‹ãªï¼Ÿ

### bottom type

neverã¯å€¤ã‚’æŒãŸãªã„ã¨ã„ã†ã“ã¨ã‚’è¡¨ã™å‹ã§ã‚ã‚Šbottomå‹ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ã€‚é›†åˆè«–ã§è¡¨ã™ã¨ç©ºé›†åˆã€‚

neverå‹ã«ã¯ä½•ã‚‚ä»£å…¥ã§ããªã„ï¼ˆå€¤æŒãŸãªã„ã‹ã‚‰ï¼‰ãŒã€neverå‹ã¯ä»–ã®å‹ã«ä»£å…¥ã§ãã‚‹ã€‚

ä»–ã®å…¨ã¦ã®å‹ã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ï¼ˆéƒ¨åˆ†å‹ï¼‰ã¨ãªã‚‹ã€‚

is-aã®é–¢ä¿‚ã€‚é€†ã¯ã§ããªã„ï¼ˆä»–ã®å‹ã‚’neverå‹ã«ä»£å…¥ï¼‰

```typescript
let neverVal: never = 1 as never;
// never å‹ã¯ bottom type ãªã®ã§stringå‹ã«ä»£å…¥å¯èƒ½

let str: string = neverVal;
```

ã¡ãªã¿ã«unkhownã¯å…¨ã¦ã®å‹ã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¿ã‚¤ãƒ—ãªã®ã§ã©ã‚“ãªå‹ã§ã‚‚ä»£å…¥å¯èƒ½

```typescript
let str = 'str';

// unkhown å‹ã¯ super type ãªã®ã§stringå‹ã‚’ä»£å…¥å¯èƒ½
let neverVal: unknown = str;
```

[TSå‹ã®éšå±¤æ€§](https://zenn.dev/estra/articles/typescript-type-set-hierarchy#%E5%9E%8B%E3%81%AE%E9%9A%8E%E5%B1%A4%E6%80%A7) ã«è©³ã—ãèª¬æ˜ãŒã‚ã‚‹ã€‚

## ä»Šå¾ŒçŸ¥ã‚ŠãŸã„ã“ã¨

- type widening
- homomorphic mapped types
- union distributionã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹
- etc...

## ã¾ã¨ã‚

[type-challenges](https://github.com/type-challenges/type-challenges) ã§TSã®å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ã©ã£ã·ã‚Šãƒãƒã£ãŸã€‚

ã¾ãŸå†å¸°çš„ã«è§£ãå•é¡ŒãŒå¤šã‹ã£ãŸã®ã§è‡ªç„¶ã¨å†å¸°çš„ã«è€ƒãˆã‚‰ã‚ŒãŸã®ã‚‚ã¨ã¦ã‚‚è‰¯ã‹ã£ãŸã€‚

ã“ã®çµŒé¨“ã‚’é€šã˜ã¦TSãŒå¥½ãã«ãªã£ãŸã®ã§ã‚‚ã£ã¨æ·±æ˜ã‚ŠãŸã„ã¨æ€ãˆãŸã®ã¯å¤§ããªåç©«ã€‚
